□画面遷移と手順（処理）

１．写真登録画面
手順１）ブラウザでデバイスから画像を選択する
手順２）画像のEXIFなどを解析する
手順３）画像を変換する　=> 画像の質を1/ 10まで落とす（85秒→35秒）
手順３-1）画像をストア

２．写真選択画面
※写真登録画面で12枚ぴったし選択された場合には
この画面はスキップされるが下記処理４）６）は実行される
手順５）画像を表示する
手順４）画像を切り取りする
手順４－１）切り取り済み画像をストア
手順６）画像をサーバーに送信する

３．写真確認画面
手順７）切り取り済み画像を表示する

□処理速度向上の課題
前回まで
・画像の質を1/ 10まで落とす（85秒→35秒）
・Exifの処理を最適化
・ブラウザのメモリ節約
・画像サイズを小さく 

より具体的に
手順２）画像を解析する
→exif解析の効率化
→無駄な処理をなくすことで早くした（4/5 ~ 3/4ぐらい処理時間が短くなった感じ）
手順３）画像を変換する
→SVG
→これは今回なかなか難しい。。。
Oclot  ）ファイル → base64 → canvas → base64 → croppie.js
Pinhole）ファイル → base64 → svgクロップもできる
しかし、
・画像サイズを小さく 
→画像圧縮でなんとかなりそう
https://xkeshi.github.io/image-compressor/

手順３－１,４－１）
→リソースの見直し（メモリ節約）
→IndexedDB 、WebWorker
→Pinholeでも使われていた

手順６）画像をサーバーに送信する
→リソースの見直し（メモリ節約）
→WebWorker

画面遷移のタイミングを速くする。画像表示中に遷移させる。
→これがなかなかユーザ的には反応性のよいインタフェース
→タイマーへの委譲


□その他
悪意あるコードへの対応策として、各ブラウザはタスク実行時間に
制限を設けている。例えば、Safariの上限値は5秒らしい。
落ちているのではなく、落とされているっぽい。
→善意あるコードを書く

WebWorker
https://developer.mozilla.org/ja/docs/Web/API/Web_Workers_API/Using_web_workers
Pinholeでは画像処理演算に使われていた

Pinholeコードを見たことで確信がもてた

Pinhole
JCrop

□参考
ハイパフォーマンスJavaScript, O'Reilly
PinholeのJavaScriptコード
